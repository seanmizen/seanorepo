<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>swindowzig Debug Viewer</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: auto;
        background: #1a1a1a;
        font-family: 'Courier New', monospace;
        color: #0f0;
        user-select: text;
        -webkit-user-select: text;
      }
      canvas {
        display: none;
      }
      #debug {
        padding: 20px;
        box-sizing: border-box;
        white-space: pre;
        font-size: 14px;
        line-height: 1.5;
        user-select: text;
        -webkit-user-select: text;
        cursor: text;
      }
      .section {
        margin-bottom: 15px;
      }
      .title {
        color: #ff0;
        font-weight: bold;
        text-decoration: underline;
      }
      .value {
        color: #0ff;
      }
      .active {
        color: #0f0;
        font-weight: bold;
      }
      .inactive {
        color: #444;
      }
      #pause-indicator {
        position: fixed;
        top: 10px;
        right: 10px;
        background: #ff0;
        color: #000;
        padding: 5px 10px;
        font-weight: bold;
        border-radius: 3px;
        display: none;
      }
      #pause-indicator.visible {
        display: block;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas"></canvas>
    <div id="pause-indicator">⏸ PAUSED (Space to resume)</div>
    <div id="debug"></div>
    <script type="module" src="./boot.js"></script>
    <script>
      // Update debug display
      let paused = false;
      let manualPause = false;

      const pauseIndicator = document.getElementById('pause-indicator');

      function updatePauseIndicator() {
        pauseIndicator.classList.toggle('visible', paused || manualPause);
      }

      // Detect text selection and pause updates
      document.addEventListener('selectionchange', () => {
        const selection = window.getSelection();
        paused = selection && selection.toString().length > 0;
        updatePauseIndicator();
      });

      // Manual pause/resume with spacebar
      document.addEventListener('keydown', (e) => {
        if (e.code === 'Space' && !e.repeat) {
          manualPause = !manualPause;
          updatePauseIndicator();
          e.preventDefault();
        }
      });

      // Update at display refresh rate
      function updateDebug() {
        const d = window.swindowzigDebug;
        if (!d || paused || manualPause) {
          requestAnimationFrame(updateDebug);
          return;
        }

        const debug = document.getElementById('debug');
        debug.innerHTML = `
<span class="title">═══════════════════════════════════════════════════</span>
<span class="title">  SWINDOWZIG DEBUG VIEWER</span>
<span class="title">═══════════════════════════════════════════════════</span>

<span class="section"><span class="title">TIMING</span>
  Tick:      <span class="value">${d.tick}</span>
  dt:        <span class="value">${(d.dt_ns / 1_000_000).toFixed(2)} ms</span>
  Time:      <span class="value">${(d.time_ns / 1_000_000_000).toFixed(2)} s</span>
  FPS:       <span class="value">${d.fps}</span></span>

<span class="section"><span class="title">WINDOW</span>
  Size:      <span class="value">${d.window.width} × ${d.window.height}</span>
  DPI Scale: <span class="value">${d.window.dpi_scale.toFixed(2)}</span></span>

<span class="section"><span class="title">MOUSE</span>
  Position:  <span class="value">${d.mouse.x.toFixed(0)}, ${d.mouse.y.toFixed(0)}</span>
  Delta:     <span class="value">${d.mouse.dx.toFixed(2)}, ${d.mouse.dy.toFixed(2)}</span>
  Left:      <span class="${d.buttons.left ? 'active' : 'inactive'}">${d.buttons.left ? '■ DOWN' : '□ up'}</span>
  Right:     <span class="${d.buttons.right ? 'active' : 'inactive'}">${d.buttons.right ? '■ DOWN' : '□ up'}</span>
  Middle:    <span class="${d.buttons.middle ? 'active' : 'inactive'}">${d.buttons.middle ? '■ DOWN' : '□ up'}</span></span>

<span class="section"><span class="title">KEYBOARD</span>
  Pressed:   <span class="value">${d.keys.pressed}</span> keys
  Down:      <span class="value">${d.keys.down}</span> keys
  Released:  <span class="value">${d.keys.released}</span> keys</span>

<span class="section"><span class="title">MODIFIERS</span>
  Ctrl:      <span class="${d.mods.ctrl ? 'active' : 'inactive'}">${d.mods.ctrl ? '■ DOWN' : '□ up'}</span>
  Shift:     <span class="${d.mods.shift ? 'active' : 'inactive'}">${d.mods.shift ? '■ DOWN' : '□ up'}</span>
  Alt:       <span class="${d.mods.alt ? 'active' : 'inactive'}">${d.mods.alt ? '■ DOWN' : '□ up'}</span>
  Super:     <span class="${d.mods.super ? 'active' : 'inactive'}">${d.mods.super ? '■ DOWN' : '□ up'}</span></span>

<span class="section"><span class="title">WHEEL</span>
  Delta:     <span class="value">${d.wheel.dx.toFixed(2)}, ${d.wheel.dy.toFixed(2)}</span></span>

<span class="section"><span class="title">TEXT INPUT</span>
  Length:    <span class="value">${d.text_len}</span> bytes</span>

<span class="title">═══════════════════════════════════════════════════</span>
`;
        requestAnimationFrame(updateDebug);
      }

      requestAnimationFrame(updateDebug);
    </script>
  </body>
</html>
